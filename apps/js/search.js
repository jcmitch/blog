function scanPageForMessages() {
  var messages = document.querySelectorAll(".webMessengerMessageGroup"),
      result = [];

  for (var i = 0; i < messages.length; i++) {
    var message = messages[i],
        catDiv = message.querySelectorAll("div.mvs"),
        timestamp = message.querySelector("abbr.timestamp[data-utime]"),
        profileLink = message.querySelector("strong > a[data-hovercard]");

    var catUrl = '';
	if (catDiv && catDiv.length) {
		catDiv = catDiv[0];
		catUrl = catDiv.style.backgroundImage;

    	var millis = 0;
		if (timestamp) {
			millis = 1000 * parseFloat(timestamp.getAttribute("data-utime"));
		}

		var curDate = new Date(millis);
		var imgTagId = getImgId(catUrl);
		if (imgTagId) {
        	result.push({
          		name: profileLink.textContent,
          		t: curDate,
    			tText: isoLocalTime(curDate),
          		text: imgTagId
        	});
    	} else {
    	    console.log("UH OH: "+catUrl);
    	}
	}
  }

  return result;
}

function getImgId(rawString) {
	var imgMap = {
	    '144885315685735': '1171729405',
	    '1440866487': '1171729405',
		'1171729405': '1171729405',
		'144885185685748': '626267923',
		'1736629156': '626267923',
		'626267923': '626267923',
		'144884765685790': '552127919',
		'741930423': '552127919',
		'552127919': '552127919',
		'144885035685763': '786804483',
		'122748399': '786804483',
		'786804483': '786804483',
		'144885045685762': '1802254567',
		'150893951': '1802254567',
		'1802254567': '1802254567',
		'144884775685789': '1090082463',
		'1695481341': '1090082463',
		'1090082463': '1090082463',
		'144884925685774': '393143349',
		'1950740854': '393143349',
		'393143349': '393143349',
		'144884805685786': '2125380943',
		'513584386': '2125380943',
		'2125380943': '2125380943',
		'144884815685785': '508660310',
		'678098432': '508660310',
		'508660310': '508660310',
		'144884835685783': '1404432534',
		'2078373181': '1404432534',
		'1404432534': '1404432534',
		'144884852352448': '761170521',
		'860202441': '761170521',
		'761170521': '761170521',
		'144884865685780': '713133850',
		'925308169': '713133850',
		'713133850': '713133850',
		'144884879019112': '1054000754',
		'364990644': '1054000754',
		'1054000754': '1054000754',
		'144884895685777': '1649039599',
		'1843906892': '1649039599',
		'1649039599': '1649039599',
		'144884905685776': '548566067',
		'1766554611': '548566067',
		'548566067': '548566067',
		'144884955685771': '1652498069',
		'2113793709': '1652498069',
		'1652498069': '1652498069',
		'144884992352434': '1095176301',
		'1103580692': '1095176301',
		'1095176301': '1095176301',
		'144885022352431': '1766348599',
		'360188622': '1766348599',
		'1766348599': '1766348599',
		'144885055685761': '857638975',
		'1491783003': '857638975',
		'857638975': '857638975',
		'144885069019093': '815755387',
		'415559810': '815755387',
		'815755387': '815755387',
		'144885089019091': '1174622966',
		'1828656739': '1174622966',
		'1174622966': '1174622966',
		'144885099019090': '883250133',
		'1420350829': '883250133',
		'883250133': '883250133',
		'144885112352422': '251509877',
		'887883822': '251509877',
		'251509877': '251509877',
		'144885129019087': '61026026',
		'526997880': '61026026',
		'61026026': '61026026',
		'144885145685752': '216808128',
		'689941368': '216808128',
		'216808128': '216808128',
		'144885159019084': '344073301',
		'616979496': '344073301',
		'344073301': '344073301',
		'144885172352416': '1979258906',
		'544055519': '1979258906',
		'1979258906': '1979258906',
		'144884755685791': '728297504',
		'1677695347': '728297504',
		'728297504': '728297504',
		'144885195685747': '1064467000',
		'779309843': '1064467000',
		'1064467000': '1064467000',
		'144885225685744': '659736090',
		'1194745542': '659736090',
		'659736090': '659736090',
		'144885209019079': '1509027085',
		'533291869': '1509027085',
		'1509027085': '1509027085',
		'144885242352409': '237967665',
		'890300248': '237967665',
		'237967665': '237967665',
		'144885252352408': '299287436',
		'2097747644': '299287436',
		'299287436': '299287436',
		'144885262352407': '1665801016',
		'767992267': '1665801016',
		'1665801016': '1665801016',
		'144885275685739': '1475292467',
		'59502227': '1475292467',
		'1475292467': '1475292467',
		'144885299019070': '587340290',
		'621581422': '587340290',
		'587340290': '587340290',
		'144884739019126': '196839564',
		'917388794': '196839564',
		'196839564': '196839564',
		'144885335685733': '1670271561',
		'452702927': '1670271561',
		'1670271561': '1670271561',
		'144885325685734': '2076129329',
		'1813807610': '2076129329',
		'2076129329': '2076129329',
		'144885349019065': '539060679',
		'166165797': '539060679',
		'539060679': '539060679',
		'144884825685784': '1507947117',
		'545832363': '1507947117',
		'1507947117': '1507947117',
		'144884792352454': '1025826781',
		'1350263637': '1025826781',
		'1025826781': '1025826781',
		'554423787978809': '385744812',
		'100054140': '385744812',
		'385744812': '385744812',
		'554423861312135': '1343926834',
		'543371572': '1343926834',
		'1343926834': '1343926834',
		'554423661312155': '583126592',
		'1580660405': '583126592',
		'583126592': '583126592',
		'554423771312144': '1628791128',
		'213669015': '1628791128',
		'1628791128': '1628791128',
		'554423694645485': '141418133',
		'939476934': '141418133',
		'141418133': '141418133',
		'554423891312132': '1127255687',
		'1117931490': '1127255687',
		'1127255687': '1127255687',
		'554423957978792': '1318345945',
		'572248676': '1318345945',
		'1318345945': '1318345945',
		'554423821312139': '1602454163',
		'754579913': '1602454163',
		'1602454163': '1602454163',
		'554423831312138': '74555550',
		'1467483179': '74555550',
		'74555550': '74555550',
		'554423914645463': '1577540586',
		'445396444': '1577540586',
		'1577540586': '1577540586',
		'554423801312141': '1185337434',
		'410407790': '1185337434',
		'1185337434': '1185337434',
		'554423944645460': '1970164712',
		'2098429989': '1970164712',
		'1970164712': '1970164712',
		'554423881312133': '1375251613',
		'701880391': '1375251613',
		'1375251613': '1375251613',
		'554423931312128': '1177223253',
		'1544490328': '1177223253',
		'1177223253': '1177223253',
		'554423757978812': '352353053',
		'47937541': '352353053',
		'352353053': '352353053',
		'554423847978803': '2088008157',
		'548588579': '2088008157',
		'2088008157': '2088008157',
		'554423717978816': '591737784',
		'1149316090': '591737784',
		'591737784': '591737784',
		'554423671312154': '909068024',
		'1537735244': '909068024',
		'909068024': '909068024',
		'554423744645480': '414133737',
		'1773707705': '414133737',
		'414133737': '414133737',
		'554423684645486': '118341350',
		'1141470692': '118341350',
		'118341350': '118341350',
		'619434111483659': '1969501135',
		'22469974': '1969501135',
		'1969501135': '1969501135'
	};

	var result = '';
	var keys = Object.keys(imgMap);
	keys.some(function(key) {
	    if (rawString.indexOf(key) > -1) {
	        result = imgMap[key];
	        return true;
	    }
	});
	return result;
}

function isoLocalTime(date) {
  function pad(number) {
    if (number < 10) {
      return '0' + number;
    }
    return number;
  }

  return date.getFullYear() +
    '-' + pad(date.getMonth() + 1) +
    '-' + pad(date.getDate()) +
    ' ' + pad(date.getHours()) +
    ':' + pad(date.getMinutes());
}

var results = scanPageForMessages();

if (!Date.prototype.toISOString) {
  (function() {

    function pad(number) {
      if (number < 10) {
        return '0' + number;
      }
      return number;
    }

    Date.prototype.toISOString = function() {
      return this.getUTCFullYear() +
        '-' + pad(this.getUTCMonth() + 1) +
        '-' + pad(this.getUTCDate()) +
        'T' + pad(this.getUTCHours()) +
        ':' + pad(this.getUTCMinutes()) +
        ':' + pad(this.getUTCSeconds()) +
        '.' + (this.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) +
        'Z';
    };

    Date.prototype.toJSON = Data.prototype.toISOString;

  }());
}

copy(JSON.stringify(results, undefined, 2));
